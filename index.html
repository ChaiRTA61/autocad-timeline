<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Timeline ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏° Upload Image ‡πÅ‡∏•‡∏∞ CSV</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #uploadBox {
      width: 300px;
      height: 200px;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
      cursor: pointer;
    }
    #uploadBtn {
      color: white;
      background: transparent;
      border: 2px dashed white;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
      position: absolute;
      z-index: 2;
    }
    #previewImage {
      max-width: 100%;
      max-height: 100%;
      display: none;
      cursor: pointer;
      object-fit: cover;
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    #fileInput, #csvInput { display: none; }
    #formSection {
      display: none;
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: #f2f2f2;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 1000;
      width: 300px;
    }
    label, input { display: block; margin: 5px 0; width: 100%; box-sizing: border-box; }
    #timeline { margin-top: 30px; }
    #taskList { margin-top: 20px; }
    button { margin-top: 10px; }
    .task-item {
      margin-bottom: 8px;
      background: #f9f9f9;
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h2>üì∑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h2>
<div id="uploadBox" onclick="imageClick()">
  <button id="uploadBtn" onclick="triggerUpload(event)">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û</button>
  <input type="file" id="fileInput" accept="image/*" onchange="handleUpload(event)">
  <img id="previewImage" alt="Preview Image">
</div>

<div id="timeline"></div>

<div id="taskSection" style="margin-top:20px;">
  <button id="toggleTaskBtn" onclick="toggleTaskSection()">‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞ CSV</button>
  <div id="taskList" style="margin-top:10px;"></div>
  <div style="margin-top: 10px;">
    <button onclick="triggerCSV()">üì• ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î CSV</button>
    <input type="file" id="csvInput" accept=".csv" onchange="handleCSV(event)">
    <button onclick="downloadCSV()">üì§ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
  </div>
</div>

<h2>üìÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
<div id="formSection">
  <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå: <input type="text" id="projectName"></label>
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: <input type="date" id="startDate"></label>
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: <input type="date" id="endDate"></label>
  <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô: <input type="text" id="taskDetails"></label>
  <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô: <input type="text" id="ownerName"></label>
  <label>‡∏û‡∏≤‡∏ò‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: <input type="text" id="filePath" placeholder="‡πÄ‡∏ä‡πà‡∏ô C:\\Users\\...\\‡πÑ‡∏ü‡∏•‡πå.pdf"></label>
  <button onclick="addToTimeline()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
  <button onclick="closeForm()">‡∏õ‡∏¥‡∏î</button>
</div>

<script>
  google.charts.load("current", { packages: ["timeline"] });
  google.charts.setOnLoadCallback(initChart);

  let chart, dataTable;
  let timelineData = [];

  const uploadBtn = document.getElementById("uploadBtn");
  const fileInput = document.getElementById("fileInput");
  const previewImage = document.getElementById("previewImage");

  window.addEventListener("load", () => {
    const savedImage = localStorage.getItem("uploadedImage");
    if (savedImage) {
      previewImage.src = savedImage;
      previewImage.style.display = "block";
      uploadBtn.style.display = "none";
    }

    const saved = localStorage.getItem("timelineData");
    if (saved) {
      timelineData = JSON.parse(saved);
    }

    initChart();
    loadSavedFormValues();
    document.getElementById("taskSection").style.display = "block";
  });

  function triggerUpload(e) { e.stopPropagation(); fileInput.click(); }
  function imageClick() { if (previewImage.style.display === "block") fileInput.click(); }

  function handleUpload(event) {
    const file = event.target.files[0];
    if (!file || !file.type.startsWith("image/")) return;
    const reader = new FileReader();
    reader.onload = e => {
      previewImage.src = e.target.result;
      previewImage.style.display = "block";
      uploadBtn.style.display = "none";
      localStorage.setItem("uploadedImage", e.target.result);
    };
    reader.readAsDataURL(file);
  }

  function initChart() {
    const container = document.getElementById("timeline");
    chart = new google.visualization.Timeline(container);
    dataTable = new google.visualization.DataTable();
    dataTable.addColumn({ type: "string", id: "‡∏á‡∏≤‡∏ô" });
    dataTable.addColumn({ type: "string", role: "tooltip", p: { html: true } });
    dataTable.addColumn({ type: "date", id: "‡πÄ‡∏£‡∏¥‡πà‡∏°" });
    dataTable.addColumn({ type: "date", id: "‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î" });
    drawChart();
    renderTaskList();
  }

  function drawChart() {
    const container = document.getElementById("timeline");
    container.style.height = (timelineData.length * 50 + 50) + "px";

    dataTable.removeRows(0, dataTable.getNumberOfRows());
    timelineData.forEach(row => {
      const [name, start, end, details, owner, filePath] = row;
      const steps = details.split(",").map(s => `<li>${s.trim()}</li>`).join("");
      const tooltip = `<div style='padding:10px; font-size:14px;'><strong>üìå ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô:</strong> ${name}<br/><strong>üë§ ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô:</strong> ${owner}<br/><strong>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><ol>${steps}</ol></div>`;
      const fileURL = "file:///" + filePath.replace(/\\/g, "/");
      const link = `<a href='${fileURL}' target='_blank'>${name}</a>`;
      dataTable.addRow([link, tooltip, new Date(start), new Date(end)]);
    });

    chart.draw(dataTable, { tooltip: { isHtml: true } });
  }

  function renderTaskList() {
    const container = document.getElementById("taskList");
    container.innerHTML = "<h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h3>";
    timelineData.forEach((row, index) => {
      const [name, start, end, details, owner, filePath] = row;
      const div = document.createElement("div");
      div.className = "task-item";
      div.innerHTML = `üõ†Ô∏è <strong>${name}</strong><br/>üìÖ ${start} ‡∏ñ‡∏∂‡∏á ${end}<br/>üë§ ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô: ${owner}<br/>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${details}<br/>üìÅ ‡πÑ‡∏ü‡∏•‡πå: ${filePath}<br/><button onclick="deleteTask(${index})">üóëÔ∏è ‡∏•‡∏ö</button>`;
      container.appendChild(div);
    });
  }

  function addToTimeline() {
    const name = document.getElementById("projectName").value.trim();
    const start = document.getElementById("startDate").value;
    const end = document.getElementById("endDate").value;
    const details = document.getElementById("taskDetails").value.trim();
    const owner = document.getElementById("ownerName").value.trim();
    const filePath = document.getElementById("filePath").value.trim();

    if (!name || !start || !end || !details || !owner || !filePath) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
      return;
    }
    if (new Date(start) > new Date(end)) {
      alert("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
      return;
    }

    timelineData.push([name, start, end, details, owner, filePath]);
    localStorage.setItem("timelineData", JSON.stringify(timelineData));
    drawChart();
    renderTaskList();
    clearInputs();
    closeForm();
  }

  function deleteTask(index) {
    if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
      timelineData.splice(index, 1);
      localStorage.setItem("timelineData", JSON.stringify(timelineData));
      drawChart();
      renderTaskList();
    }
  }

  function clearInputs() {
    ["projectName", "startDate", "endDate", "taskDetails", "ownerName", "filePath"].forEach(id => {
      document.getElementById(id).value = "";
      localStorage.removeItem("form_" + id);
    });
  }

  function closeForm() {
    document.getElementById("formSection").style.display = "none";
  }

  document.addEventListener("click", () => {
    document.getElementById("formSection").style.display = "block";
  }, { once: true });

  function triggerCSV() {
    document.getElementById("csvInput").click();
  }

  function handleCSV(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const lines = e.target.result.split(/\r?\n/).slice(1);
      for (let line of lines) {
        if (!line.trim()) continue;
        const [index, name, details, start, end, owner, filePath] = line.split(",");
        if (!name || !start || !end || !details || !owner || !filePath) continue;
        timelineData.push([name.trim(), start.trim(), end.trim(), details.trim(), owner.trim(), filePath.trim()]);
      }
      localStorage.setItem("timelineData", JSON.stringify(timelineData));
      drawChart();
      renderTaskList();
    };
    reader.readAsText(file);
  }

  function downloadCSV() {
    if (timelineData.length === 0) {
      alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Timeline");
      return;
    }
    const header = ["‡∏•‡∏≥‡∏î‡∏±‡∏ö", "‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô", "‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°", "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î", "‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô", "‡∏û‡∏≤‡∏ò‡πÑ‡∏ü‡∏•‡πå"];
    const rows = timelineData.map((row, i) => [i + 1, ...row.map(val => `"${val.replace(/"/g, '""')}"`)]);
    const csv = header.join(",") + "\n" + rows.map(r => r.join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "timeline_export.csv";
    link.click();
  }

  function toggleTaskSection() {
    const section = document.getElementById("taskSection");
    section.style.display = (section.style.display === "none" || section.style.display === "") ? "block" : "none";
  }

  function loadSavedFormValues() {
    ["projectName", "startDate", "endDate", "taskDetails", "ownerName", "filePath"].forEach(id => {
      const saved = localStorage.getItem("form_" + id);
      if (saved) document.getElementById(id).value = saved;
    });
  }

  ["projectName", "startDate", "endDate", "taskDetails", "ownerName", "filePath"].forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener("input", () => localStorage.setItem("form_" + id, input.value));
  });
</script>

</body>
</html>
